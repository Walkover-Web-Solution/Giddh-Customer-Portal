<mat-spinner *ngIf="initialLoading"></mat-spinner>
<div class="common-wrapper" *ngIf="!initialLoading">
  <div class="inner-header">
    <h2>Payments Made</h2>
  </div>
  <div class="inner-content">
    <div class="d-flex column-gap10 res-field">
      <mat-form-field appearance="outline">
        <mat-label>Status</mat-label>
        <mat-select
          [(value)]="selectedStatusValue"
          (selectionChange)="onStatusSelected()"
        >
          <mat-option
            *ngFor="let status of statusOptions"
            [value]="status.value"
            >{{ status.label }}</mat-option
          >
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Sort By</mat-label>
        <mat-select
          [(value)]="selectedOption"
          (selectionChange)="onSortBySelected()"
        >
          <mat-option
            *ngFor="let sortByOption of sortByOptions"
            [value]="sortByOption.value"
            >{{ sortByOption.label }}</mat-option
          >
        </mat-select>
      </mat-form-field>
      <button
        *ngIf="showClearFilter"
        mat-stroked-button
        color="primary"
        (click)="resetFilter()"
        class="clear-button"
      >
        Clear
      </button>
    </div>
    <mat-spinner *ngIf="isLoading"></mat-spinner>
    <div class="invoice-table mr-t15" *ngIf="!isLoading">
      <div class="table-responsive">
        <table
          mat-table
          [dataSource]="dataSource"
          class="mat-elevation-z8"
          matSort
          (matSortChange)="sortData($event)"
          [matSortDirection]="paymentListRequest.sort"
          [matSortActive]="paymentListRequest.sortBy"
        >
          <ng-container matColumnDef="payment">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Payment#</th>
            <td mat-cell *matCellDef="let element">
              <a href="javascript:;" (click)="invoicePreview(element)">
                {{ element.voucherNumber }}
              </a>
            </td>
          </ng-container>
          <ng-container matColumnDef="voucherDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Date</th>
            <td mat-cell *matCellDef="let element">
              {{ element?.voucherDate }}
            </td>
          </ng-container>
          <ng-container matColumnDef="amount">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="text-right sort-header-right"
              mat-sort-header
            >
              Amount
            </th>
            <td mat-cell *matCellDef="let element" class="text-right">
              {{ element?.accountCurrencySymbol }}
              {{ element?.grandTotal?.amountForAccount }}
            </td>
          </ng-container>
          <ng-container matColumnDef="mode">
            <th mat-header-cell *matHeaderCellDef>Mode</th>
            <td mat-cell *matCellDef="let element">
              <div class="d-flex column-gap10">
                <span class="color-overdue"
                  >{{ element?.paymentMode?.name | uppercase }}
                </span>
              </div>
            </td>
          </ng-container>
          <ng-container matColumnDef="unused">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="text-right sort-header-right"
              mat-sort-header
            >
              Unused Amount
            </th>
            <td mat-cell *matCellDef="let element" class="text-right">
              {{ element?.accountCurrencySymbol }}
              {{ element?.grandTotal?.amountForAccount }}
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>

        <mat-paginator
          (page)="handlePageChange($event)"
          [length]="invoiceListData?.length"
          [pageSize]="paymentListRequest.count"
          [showFirstLastButtons]="true"
          [pageSizeOptions]="[5, 10, 15, 20]"
          [hidePageSize]="false"
          [pageIndex]="pageIndex"
        >
        </mat-paginator>
        <div class="text-center pd-t1 pd-b1">
          <p class="no-data" *ngIf="!invoiceListData?.length">
            There are no open invoices which await your approval.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- onclick table-paynow -->
<ng-template #paytablemodal>
  <div class="common-dialog">
    <mat-dialog-content>
      <div class="d-flex column-gap15 danger-wrap">
        <img
          src="../../assets/images/warning.svg"
          alt="warning"
          class="mr-t5"
        />
        <p>
          Looks like you've already initiated payment(s) for this invoice.
          Initiating a new payment will <strong>not</strong> override the
          payment(s) in progress. Are you sure you want to proceed?
        </p>
      </div>
      <div class="d-flex column-gap5 footer-btn">
        <button mat-stroked-button color="primary" (click)="voucherPay()">
          Yes, Proceed
        </button>
        <button mat-stroked-button mat-dialog-close>Cancel</button>
      </div>
    </mat-dialog-content>
  </div>
</ng-template>
